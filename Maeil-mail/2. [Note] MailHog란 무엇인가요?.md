## 1. MailHog란 무엇인가요?

---

**"개발자들을 위한 안전한 가짜 우체국"**

우리가 앱을 만들다 보면 "회원가입 환영 메일", "비밀번호 찾기" 같이 이메일을 보내는 기능을 테스트해야 합니다. 그런데 개발할 때마다 진짜 네이버나 구글 메일 서버를 쓰면 어떤 일이 벌어질까요?

1. **스팸 신고 당함:** 실수로 테스트 메일 1,000통을 진짜 사람에게 보내버린다면? 
2. **돈이 듦:** 대량 발송 서비스는 돈을 내야 합니다.
3. **확인이 귀찮음:** 내 메일함에 들어가서 F5를 눌러가며 확인해야 합니다.

MailHog는 이 문제를 해결해 주는 가짜 SMTP 서버입니다.

앱이 메일을 보내면, MailHog가 중간에서 "어, 잘 받았어! (사실 안 보냄)" 하고 낚아챈 뒤, 자기 뱃속(메모리)에 저장해 둡니다. 그리고 개발자는 웹사이트를 통해 그 메일을 눈으로 확인할 수 있죠.

---

</br>

## 2. 코드 속 MailHog 분석

보여주신 `compose.perf.yml` 파일에서 MailHog는 `mm-mail`이라는 서비스명으로 정의되어 있습니다.

```yaml
 mm-mail:
    container_name: mm-mail
    image: mailhog/mailhog  # 👈 여기가 핵심! MailHog 이미지를 가져옵니다.
    restart: no
    networks:
      perf-network:
        ipv4_address: 172.16.0.8
    ports:
      - "8025:8025"          # 👈 웹에서 메일함 보는 구멍
```

### 1. `image: mailhog/mailhog`

도커 허브(Docker Hub)에 있는 공식 MailHog 이미지를 다운로드 받아 실행합니다. 별도의 설치 과정 없이 이 한 줄이면 가짜 우체국이 뚝딱 세워집니다.

### 2. `ports: "8025:8025"` (눈으로 보는 문 )

이 설정 덕분에, 컨테이너가 실행되면 브라우저에서 http://localhost:8025로 접속할 수 있습니다.

<img width="638" height="499" alt="image" src="https://github.com/user-attachments/assets/821c1a4d-98ec-4382-a9ef-708eac28ab56" />


접속하면 빨간색 헤더의 귀여운 돼지 그림이 있는 웹 메일함이 열립니다. 여기서 테스트로 보낸 메일들을 클릭해서 내용을 볼 수 있습니다.

### 3. 숨겨진 포트 `1025` (메일 넣는 문 )

코드에는 1025 포트가 ports 항목으로 노출되어 있지 않지만, MailHog는 기본적으로 1025번 포트를 통해 메일을 받습니다.

이 파일에서는 내부 네트워크(perf-network)를 통해서만 접근하도록 숨겨둔 상태입니다.

---

</br>

## 3. 심화: 이 파일만의 독특한 구조 (Proxy의 존재)

단순히 MailHog만 있는 게 아니라, 바로 아래에 `mm-mail-proxy`라는 녀석이 붙어 있습니다. 이게 성능 테스트 환경의 핵심 포인트입니다!

```yaml
  mm-mail-proxy:
    container_name: mm-mail-proxy
    # ... (생략)
    depends_on:
      - mm-mail
    environment:
      TPS: 14               # 👈 초당 처리량 제한 (Throttle)
      FORWARD_HOST: 172.16.0.8  # 👈 mm-mail(MailHog)의 IP 주소
      FORWARD_PORT: 1025    # 👈 MailHog의 메일 받는 구멍
```

- **상황:** 성능 테스트를 하면 1초에 수백, 수천 건의 메일 요청이 쏟아집니다.
- **문제:** MailHog가 아무리 가짜라도 너무 많이 쏟아지면 뻗어버릴 수 있겠죠? 혹은 실제 운영 환경처럼 "초당 발송량 제한"을 테스트하고 싶을 수도 있습니다.
- **해결:** 앱(`mm-app`)이 MailHog에 직접 던지는 게 아니라, 대리인(`Proxy`)에게 먼저 던집니다.
    - 이 프록시는 `TPS: 14` (초당 14건)로 속도를 조절하면서, 뒤에 있는 `mm-mail`(MailHog)에게 안전하게 전달해 줍니다.

---

## 4. 요약

1. **MailHog(`mm-mail`)**: 실제 발송은 안 하고 흉내만 내는 **안전한 가짜 우체국**입니다.
2. **8025 포트**: 개발자가 "메일 잘 왔나?" 하고 **눈으로 확인하는 웹사이트** 주소입니다.
3. **Proxy(`mm-mail-proxy`)**: 성능 테스트 중 메일이 폭주하지 않도록 속도를 조절해주는 **교통 정리원**이 MailHog 앞을 지키고 있습니다.

> "성능 테스트 환경에서는 메일 폭주를 막기 위해 MailHog 앞에 프록시를 둬서 속도를 조절(TPS: 14)하고 있다. 우리는 결과만 localhost:8025에서 확인하면 된다!"
>
